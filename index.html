<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Terminal Draw - ASCII Art Editor</title>
        <style>
            /* Prevent FOUC (Flash of Unstyled Content) */
            body {
                visibility: hidden;
            }
            body.loaded {
                visibility: visible;
            }
        </style>
        <link rel="stylesheet" href="styles/main.css" />
        <link rel="stylesheet" href="styles/grid.css" />
        <link rel="stylesheet" href="styles/ui.css" />
        <link rel="stylesheet" href="styles/startup-dialog.css" />
    </head>
    <body>
        <div id="app">
            <header style="display: flex; flex-direction: column">
                <div id="toolbar">
                    <h1 style="margin: 0; font-size: 1.2em">Terminal Draw</h1>
                    <button id="tool-brush" class="tool-btn active">
                        üñåÔ∏è <span class="key">[B]</span>rush
                    </button>
                    <button id="tool-eraser" class="tool-btn">
                        üßπ <span class="key">[E]</span>raser
                    </button>
                    <button id="tool-picker" class="tool-btn">
                        üíß <span class="key">[P]</span>icker
                    </button>
                    <button id="tool-spray" class="tool-btn">
                        üé® <span class="key">[S]</span>pray
                    </button>
                    <button id="tool-rectangle" class="tool-btn">
                        ‚ñ≠ <span class="key">[R]</span>ectangle
                    </button>
                    <button id="tool-line" class="tool-btn">
                        ‚ï± <span class="key">[L]</span>ine
                    </button>
                    <button id="tool-circle" class="tool-btn">
                        ‚óã <span class="key">[C]</span>ircle
                    </button>
                    <button id="tool-floodfill" class="tool-btn">
                        ü™£ <span class="key">[F]</span>ill
                    </button>
                    <button id="tool-text" class="tool-btn">
                        üìù <span class="key">[T]</span>ext
                    </button>
                    <button id="tool-selection" class="tool-btn">
                        üî≤ <span class="key">[V]</span>select
                    </button>

                    <!-- Undo/Redo buttons -->
                    <div class="toolbar-separator"></div>
                    <button
                        id="undo-btn"
                        class="tool-btn"
                        title="Undo (Ctrl+Z)"
                        disabled
                    >
                        ‚Ü∂ Undo
                    </button>
                    <button
                        id="redo-btn"
                        class="tool-btn"
                        title="Redo (Ctrl+Y)"
                        disabled
                    >
                        ‚Ü∑ Redo
                    </button>

                    <!-- Animation controls -->
                    <div class="toolbar-separator"></div>
                    <button
                        id="anim-play-btn"
                        class="tool-btn"
                        title="Play/Pause Animation"
                    >
                        ‚ñ∂ Play
                    </button>
                    <span
                        id="anim-status"
                        style="font-size: 0.85em; color: var(--text-muted)"
                    ></span>
                    <button
                        id="particle-toggle"
                        class="tool-btn"
                        title="Particle Effects"
                    >
                        ‚ú® Particles
                    </button>

                    <div
                        style="
                            margin-left: auto;
                            display: flex;
                            gap: 8px;
                            align-items: center;
                        "
                    >
                        <button
                            id="scale-to-fit-btn"
                            class="tool-btn"
                            title="Scale to Fit"
                        >
                            üîç
                        </button>
                        <input
                            type="range"
                            id="scale-slider"
                            min="10"
                            max="1000"
                            value="100"
                            step="5"
                            title="Zoom"
                            style="width: 80px"
                        />
                        <span
                            id="scale-value"
                            style="font-size: 12px; min-width: 40px"
                            >100%</span
                        >
                        <button id="io-toggle" class="tool-btn">üíæ I/O</button>
                    </div>
                </div>

                <!-- Tool Options Bar (contextual options for selected tool) -->
                <div
                    id="tool-options-bar"
                    style="
                        display: flex;
                        padding: 8px 16px;
                        background: var(--bg-primary);
                        gap: 16px;
                        align-items: center;
                        min-height: 52px;
                        height: 52px;
                        border-bottom: 1px solid var(--border);
                    "
                >
                    <!-- Spray Tool Options -->
                    <div
                        id="spray-options"
                        style="display: none; align-items: center; gap: 16px"
                    >
                        <label style="font-weight: 500">Preset:</label>
                        <select
                            id="spray-preset"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="artist">Artist</option>
                            <option value="blocks">Blocks</option>
                            <option value="dots">Dots</option>
                            <option value="stipple">Stipple</option>
                            <option value="heights">Heights</option>
                            <option value="widths">Widths</option>
                            <option value="stars">Stars</option>
                            <option value="triangles">Triangles</option>
                            <option value="crosses">Crosses</option>
                            <option value="waves">Waves</option>
                        </select>

                        <label style="font-weight: 500">Size:</label>
                        <select
                            id="spray-radius"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="2">Small</option>
                            <option value="3" selected>Medium</option>
                            <option value="5">Large</option>
                        </select>

                        <label style="font-weight: 500">Density:</label>
                        <select
                            id="spray-coverage"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="0.025">Light</option>
                            <option value="0.05" selected>Medium</option>
                            <option value="0.1">Dense</option>
                            <option value="0.5">Heavy</option>
                        </select>
                    </div>

                    <!-- Brush Tool Options -->
                    <div
                        id="brush-options"
                        style="display: none; align-items: center; gap: 16px"
                    >
                        <label style="font-weight: 500">Size:</label>
                        <select
                            id="brush-size"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="1" selected>1x1</option>
                            <option value="2">2x2</option>
                            <option value="3">3x3</option>
                            <option value="5">5x5</option>
                            <option value="7">7x7</option>
                        </select>

                        <label style="font-weight: 500">Shape:</label>
                        <select
                            id="brush-shape"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="square" selected>Square</option>
                            <option value="circle">Circle</option>
                            <option value="triangle">Triangle</option>
                            <option value="cross">Cross (X)</option>
                            <option value="plus">Plus (+)</option>
                            <option value="minus">Minus (-)</option>
                        </select>

                        <div
                            class="toolbar-separator"
                            style="height: 24px; margin: 0 8px"
                        ></div>

                        <!-- Animation Section Header -->
                        <span style="font-weight: 600; margin-right: 8px"
                            >Animation:</span
                        >

                        <!-- Glyph Animation Row -->
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 6px;
                                padding: 2px 6px;
                                background: var(--ui-bg);
                                border-radius: 4px;
                            "
                        >
                            <input
                                type="checkbox"
                                id="glyph-anim-enabled"
                                title="Enable glyph animation"
                            />
                            <label style="font-size: 0.85em; min-width: 35px"
                                >Glyph</label
                            >
                            <div
                                id="glyph-anim-details"
                                style="
                                    display: none;
                                    align-items: center;
                                    gap: 6px;
                                "
                            >
                                <input
                                    type="text"
                                    id="glyph-anim-frames"
                                    value="‚òÖ‚ú¶¬∑"
                                    maxlength="16"
                                    placeholder="chars"
                                    style="
                                        width: 60px;
                                        padding: 3px 5px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-family: monospace;
                                        font-size: 0.9em;
                                    "
                                />
                                <select
                                    id="glyph-anim-speed"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="1000">Slow</option>
                                    <option value="500" selected>Med</option>
                                    <option value="250">Fast</option>
                                </select>
                                <select
                                    id="glyph-anim-offset"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="sync">Sync</option>
                                    <option value="random">Rand</option>
                                </select>
                                <select
                                    id="glyph-anim-mode"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="forward">Fwd</option>
                                    <option value="reverse">Rev</option>
                                    <option value="pingpong">Ping</option>
                                    <option value="random">Rand</option>
                                </select>
                            </div>
                        </div>

                        <!-- FG Animation Row -->
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 6px;
                                padding: 2px 6px;
                                background: var(--ui-bg);
                                border-radius: 4px;
                            "
                        >
                            <input
                                type="checkbox"
                                id="fg-anim-enabled"
                                title="Enable foreground color animation"
                            />
                            <label style="font-size: 0.85em; min-width: 35px"
                                >FG</label
                            >
                            <div
                                id="fg-anim-details"
                                style="
                                    display: none;
                                    align-items: center;
                                    gap: 6px;
                                "
                            >
                                <input
                                    type="text"
                                    id="fg-anim-colors"
                                    value="01234567"
                                    maxlength="16"
                                    placeholder="0-7,8=trans"
                                    style="
                                        width: 60px;
                                        padding: 3px 5px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-family: monospace;
                                        font-size: 0.9em;
                                    "
                                />
                                <select
                                    id="fg-anim-speed"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="1000">Slow</option>
                                    <option value="500" selected>Med</option>
                                    <option value="250">Fast</option>
                                </select>
                                <select
                                    id="fg-anim-offset"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="sync">Sync</option>
                                    <option value="random">Rand</option>
                                </select>
                                <select
                                    id="fg-anim-mode"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="forward">Fwd</option>
                                    <option value="reverse">Rev</option>
                                    <option value="pingpong">Ping</option>
                                    <option value="random">Rand</option>
                                </select>
                            </div>
                        </div>

                        <!-- BG Animation Row -->
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 6px;
                                padding: 2px 6px;
                                background: var(--ui-bg);
                                border-radius: 4px;
                            "
                        >
                            <input
                                type="checkbox"
                                id="bg-anim-enabled"
                                title="Enable background color animation"
                            />
                            <label style="font-size: 0.85em; min-width: 35px"
                                >BG</label
                            >
                            <div
                                id="bg-anim-details"
                                style="
                                    display: none;
                                    align-items: center;
                                    gap: 6px;
                                "
                            >
                                <input
                                    type="text"
                                    id="bg-anim-colors"
                                    value="14"
                                    maxlength="16"
                                    placeholder="0-7,8=trans"
                                    style="
                                        width: 60px;
                                        padding: 3px 5px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-family: monospace;
                                        font-size: 0.9em;
                                    "
                                />
                                <select
                                    id="bg-anim-speed"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="1000">Slow</option>
                                    <option value="500" selected>Med</option>
                                    <option value="250">Fast</option>
                                </select>
                                <select
                                    id="bg-anim-offset"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="sync">Sync</option>
                                    <option value="random">Rand</option>
                                </select>
                                <select
                                    id="bg-anim-mode"
                                    style="
                                        padding: 3px;
                                        background: var(--ui-bg);
                                        color: var(--ui-text);
                                        border: 1px solid var(--ui-border);
                                        border-radius: 3px;
                                        font-size: 0.85em;
                                    "
                                >
                                    <option value="forward">Fwd</option>
                                    <option value="reverse">Rev</option>
                                    <option value="pingpong">Ping</option>
                                    <option value="random">Rand</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Rectangle Tool Options -->
                    <div
                        id="rectangle-options"
                        style="display: none; align-items: center; gap: 16px"
                    >
                        <label style="font-weight: 500">Fill:</label>
                        <select
                            id="rectangle-fill"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="outline" selected>Outline</option>
                            <option value="filled">Filled</option>
                        </select>
                    </div>

                    <!-- Circle Tool Options -->
                    <div
                        id="circle-options"
                        style="display: none; align-items: center; gap: 16px"
                    >
                        <label style="font-weight: 500">Fill:</label>
                        <select
                            id="circle-fill"
                            style="
                                padding: 6px 12px;
                                background: var(--ui-bg);
                                color: var(--ui-text);
                                border: 1px solid var(--ui-border);
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.95em;
                            "
                        >
                            <option value="outline" selected>Outline</option>
                            <option value="filled">Filled</option>
                        </select>

                        <label style="font-weight: 500">
                            <input
                                type="checkbox"
                                id="circle-ellipse"
                                style="margin-right: 6px"
                            />
                            Ellipse
                        </label>
                    </div>

                    <!-- Selection Tool Options -->
                    <div
                        id="selection-options"
                        style="display: none; align-items: center; gap: 16px"
                    >
                        <label style="font-weight: 500">Selection:</label>
                        <span
                            id="selection-info"
                            style="font-size: 0.9em; color: var(--text-muted)"
                        >
                            No selection
                        </span>

                        <div
                            style="
                                border-left: 1px solid var(--border);
                                padding-left: 16px;
                                margin-left: 8px;
                            "
                        >
                            <button
                                id="flip-horizontal-btn"
                                class="tool-btn"
                                title="Flip Selection Horizontally"
                                disabled
                            >
                                ‚ÜîÔ∏è Flip H
                            </button>
                            <button
                                id="flip-vertical-btn"
                                class="tool-btn"
                                title="Flip Selection Vertically"
                                disabled
                            >
                                ‚ÜïÔ∏è Flip V
                            </button>
                        </div>

                        <div
                            style="
                                border-left: 1px solid var(--border);
                                padding-left: 16px;
                                margin-left: 8px;
                                font-size: 0.9em;
                                color: var(--text-muted);
                            "
                        >
                            <span id="keyboard-shortcuts-hint"
                                >Copy: Ctrl+C ‚Ä¢ Cut: Ctrl+X ‚Ä¢ Paste: Ctrl+V ‚Ä¢
                                Exit: Esc</span
                            >
                        </div>
                    </div>
                </div>

                <!-- I/O Panel (collapsible) -->
                <div id="io-panel" class="io-panel hidden">
                    <div class="io-panel-content">
                        <div class="io-section">
                            <h3>Export</h3>
                            <button id="export-text" class="io-btn">
                                üìã Copy as Text
                            </button>
                            <button id="export-ansi" class="io-btn">
                                üé® Copy as ANSI
                            </button>
                            <button id="export-layer" class="io-btn">
                                üìÑ Copy Layer Only
                            </button>
                            <div
                                id="export-status"
                                class="export-status hidden"
                            >
                                ‚úÖ Copied!
                            </div>
                        </div>

                        <div class="io-section">
                            <h3>Project</h3>
                            <button id="new-project" class="io-btn">
                                ‚ú® New Project
                            </button>
                            <button id="save-project" class="io-btn">
                                üíæ Save Project
                            </button>
                            <button id="load-project" class="io-btn">
                                üìÇ Load Project
                            </button>
                            <input
                                type="file"
                                id="file-input"
                                accept=".json"
                                style="display: none"
                            />
                            <div id="dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <span class="dropzone-icon">üìÇ</span>
                                    <span class="dropzone-text"
                                        >Drop .json file here</span
                                    >
                                </div>
                            </div>
                            <div
                                id="project-status"
                                class="project-status hidden"
                            >
                                ‚úÖ Project saved!
                            </div>
                        </div>

                        <div class="io-section">
                            <h3>Grid</h3>
                            <button id="clear-grid" class="io-btn clear-btn">
                                üóëÔ∏è Clear Grid
                            </button>
                            <button id="clear-layer" class="io-btn clear-btn">
                                üßπ Clear Layer
                            </button>
                            <div id="grid-status" class="grid-status hidden">
                                ‚úÖ Grid resized!
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Particle Panel -->
                <div id="particle-panel" class="particle-panel hidden">
                    <div class="particle-panel-content">
                        <div class="particle-panel-header">
                            <h3>Particle Effects</h3>
                            <button id="particle-panel-close" class="close-btn">
                                &times;
                            </button>
                        </div>

                        <div class="particle-section">
                            <label class="section-label">Quick Add</label>
                            <div class="preset-grid">
                                <button
                                    class="preset-btn"
                                    data-preset="rain"
                                    title="Rain"
                                >
                                    üåßÔ∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="snow"
                                    title="Snow"
                                >
                                    ‚ùÑÔ∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="sparkle"
                                    title="Sparkle"
                                >
                                    ‚ú®
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="smoke"
                                    title="Smoke"
                                >
                                    üí®
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="fire"
                                    title="Fire"
                                >
                                    üî•
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="bubbles"
                                    title="Bubbles"
                                >
                                    ü´ß
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="clouds"
                                    title="Clouds"
                                >
                                    ‚òÅÔ∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="stars"
                                    title="Stars"
                                >
                                    ‚≠ê
                                </button>
                            </div>
                            <label class="section-label" style="margin-top: 8px"
                                >Dense Effects</label
                            >
                            <div class="preset-grid">
                                <button
                                    class="preset-btn"
                                    data-preset="smokePlume"
                                    title="Smoke Plume"
                                >
                                    üå´Ô∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="inferno"
                                    title="Inferno"
                                >
                                    üî•
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="stormClouds"
                                    title="Storm Clouds"
                                >
                                    ‚õàÔ∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="fog"
                                    title="Fog"
                                >
                                    üåÅ
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="embers"
                                    title="Embers"
                                >
                                    ‚ú®
                                </button>
                            </div>
                            <label class="section-label" style="margin-top: 8px"
                                >Radial / Physics</label
                            >
                            <div class="preset-grid">
                                <button
                                    class="preset-btn"
                                    data-preset="explosion"
                                    title="Explosion"
                                >
                                    üí•
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="burst"
                                    title="Burst"
                                >
                                    üí´
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="fountain"
                                    title="Fountain"
                                >
                                    ‚õ≤
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="firework"
                                    title="Firework"
                                >
                                    üéÜ
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="shockwave"
                                    title="Shockwave"
                                >
                                    üîò
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="confetti"
                                    title="Confetti"
                                >
                                    üéä
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="waterfall"
                                    title="Waterfall"
                                >
                                    üåä
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="leaves"
                                    title="Falling Leaves"
                                >
                                    üçÇ
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="meteor"
                                    title="Meteor Shower"
                                >
                                    ‚òÑÔ∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="magic"
                                    title="Magic Dust"
                                >
                                    ü™Ñ
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="steam"
                                    title="Steam"
                                >
                                    ‚ô®Ô∏è
                                </button>
                                <button
                                    class="preset-btn"
                                    data-preset="plasma"
                                    title="Plasma"
                                >
                                    üîÆ
                                </button>
                            </div>
                        </div>

                        <div class="particle-section">
                            <label class="section-label">Layer</label>
                            <select
                                id="particle-layer-select"
                                class="particle-select"
                            >
                                <option value="bg">Background</option>
                                <option value="mid" selected>Middle</option>
                                <option value="fg">Foreground</option>
                            </select>
                        </div>

                        <div class="particle-section">
                            <label class="section-label">Active Emitters</label>
                            <div id="emitter-list" class="emitter-list">
                                <div class="emitter-empty">
                                    No emitters. Click a preset to add one.
                                </div>
                            </div>
                        </div>

                        <div class="particle-section">
                            <button
                                id="clear-emitters-btn"
                                class="io-btn clear-btn"
                            >
                                üóëÔ∏è Clear All Emitters
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <main>
                <!-- Sidebar: View controls and palette selector -->
                <aside id="sidebar">
                    <!-- Glyph Picker -->
                    <div class="sidebar-section">
                        <h3>Character</h3>
                        <div id="glyph-picker-trigger"></div>
                        <div class="paint-mode-controls">
                            <label for="paint-mode-toggle">Paint Mode:</label>
                            <button
                                id="paint-mode-toggle"
                                class="paint-mode-btn"
                                title="Click to cycle paint mode"
                            >
                                üé® All
                            </button>
                        </div>
                        <div class="smart-drawing-controls">
                            <label for="smart-drawing-mode"
                                >Drawing Mode:</label
                            >
                            <select id="smart-drawing-mode">
                                <option value="normal">Normal</option>
                                <option value="single">
                                    Smart Single Line
                                </option>
                                <option value="double">
                                    Smart Double Line
                                </option>
                            </select>
                        </div>
                    </div>

                    <!-- Palette Selector -->
                    <div class="sidebar-section">
                        <h3>Palette</h3>
                        <select id="palette-selector">
                            <!-- Options populated dynamically from palettes.json -->
                        </select>
                        <div class="palette-row">
                            <div
                                class="palette-swatch"
                                data-color="0"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="1"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="2"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="3"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="4"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="5"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="6"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch"
                                data-color="7"
                                title="Left-click: Foreground | Right-click: Background"
                            ></div>
                            <div
                                class="palette-swatch transparent"
                                data-color="-1"
                                title="Transparent (Right-click only: Background)"
                            ></div>
                        </div>
                        <div class="color-preview">
                            <span class="preview-label">Preview:</span>
                            <span class="preview-cell" id="color-preview"
                                >‚ñà</span
                            >
                        </div>
                    </div>

                    <!-- Layers -->
                    <div class="sidebar-section">
                        <div id="layer-panel"></div>
                    </div>
                </aside>

                <!-- Main Editor Area -->
                <div id="editor">
                    <div class="grid-container grid-stack">
                        <!-- Background: Solid color layer -->
                        <div id="background-grid" class="background-grid"></div>

                        <!-- Hit Test: Invisible layer for mouse events -->
                        <div
                            id="hit-test-layer"
                            class="hit-test-layer hit-test-overlay"
                        ></div>

                        <!-- Hover Indicator: Visual feedback for hovered cell -->
                        <div id="hover-indicator" class="hover-indicator"></div>

                        <!-- Anchor Indicator: Shows rectangle/shape start point -->
                        <div
                            id="anchor-indicator"
                            class="anchor-indicator"
                        ></div>

                        <!-- Text Layers: Dynamically generated based on scene layers -->
                        <!-- Layer containers will be created by JavaScript -->
                    </div>
                </div>
            </main>

            <footer>
                <div id="status">Ready</div>
            </footer>
        </div>

        <script type="module" src="src/app.js"></script>
        <script>
            // Show body once page is loaded
            window.addEventListener("DOMContentLoaded", () => {
                document.body.classList.add("loaded");
            });
        </script>
    </body>
</html>
